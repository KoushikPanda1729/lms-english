{
  "info": {
    "_postman_id": "col-english-speaking-backend",
    "name": "English Speaking Backend",
    "description": "All API endpoints for the English Speaking Practice Platform",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            }
          }
        },
        {
          "name": "JWKS",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/.well-known/jwks.json",
              "host": ["{{baseUrl}}"],
              "path": [".well-known", "jwks.json"]
            }
          }
        }
      ]
    },
    {
      "name": "Auth",
      "item": [
        {
          "name": "Self (Get Current User)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/auth/self",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "self"]
            }
          }
        },
        {
          "name": "Register",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('accessToken', res.data.accessToken);",
                  "  pm.environment.set('refreshToken', res.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\",\n  \"deviceId\": \"device-001\",\n  \"platform\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            }
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('accessToken', res.data.accessToken);",
                  "  pm.environment.set('refreshToken', res.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\",\n  \"password\": \"password123\",\n  \"deviceId\": \"device-001\",\n  \"platform\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            }
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('accessToken', res.data.accessToken);",
                  "  pm.environment.set('refreshToken', res.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            }
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            }
          }
        },
        {
          "name": "Google Sign-In",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.accessToken) {",
                  "  pm.environment.set('accessToken', res.data.accessToken);",
                  "  pm.environment.set('refreshToken', res.data.refreshToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"idToken\": \"<google_id_token_here>\",\n  \"deviceId\": \"device-001\",\n  \"platform\": \"web\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/google",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "google"]
            }
          }
        },
        {
          "name": "Forgot Password",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"test@example.com\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/forgot-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "forgot-password"]
            }
          }
        },
        {
          "name": "Reset Password",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"token\": \"{{resetToken}}\",\n  \"newPassword\": \"newpassword123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "reset-password"]
            }
          }
        }
      ]
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Get My Profile",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        },
        {
          "name": "Update My Profile",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"username\": \"john_doe\",\n  \"displayName\": \"John Doe\",\n  \"bio\": \"Trying to improve my English!\",\n  \"nativeLanguage\": \"Hindi\",\n  \"englishLevel\": \"beginner\",\n  \"learningGoal\": \"fluency\",\n  \"country\": \"India\",\n  \"timezone\": \"Asia/Kolkata\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/me",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me"]
            }
          }
        },
        {
          "name": "Upload Avatar",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "avatar",
                  "type": "file",
                  "src": "",
                  "description": "Select a jpeg/png/webp image (max 5MB)"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/users/me/avatar",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me", "avatar"]
            }
          }
        },
        {
          "name": "Delete Avatar",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/users/me/avatar",
              "host": ["{{baseUrl}}"],
              "path": ["users", "me", "avatar"]
            }
          }
        },
        {
          "name": "Get Public Profile",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{userId}}/public",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{userId}}", "public"]
            }
          }
        }
      ]
    },
    {
      "name": "Sessions",
      "item": [
        {
          "name": "Get My Call History",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/sessions?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["sessions"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            }
          }
        },
        {
          "name": "Get Single Session",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/sessions/{{sessionId}}",
              "host": ["{{baseUrl}}"],
              "path": ["sessions", "{{sessionId}}"]
            }
          }
        },
        {
          "name": "Rate Partner",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"stars\": 5\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/sessions/{{sessionId}}/rate",
              "host": ["{{baseUrl}}"],
              "path": ["sessions", "{{sessionId}}", "rate"]
            }
          }
        }
      ]
    },
    {
      "name": "Reports",
      "item": [
        {
          "name": "Submit Report",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reportedId\": \"{{userId}}\",\n  \"sessionId\": \"{{sessionId}}\",\n  \"reason\": \"harassment\",\n  \"description\": \"User was abusive during the call\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reports",
              "host": ["{{baseUrl}}"],
              "path": ["reports"]
            },
            "description": "reason: harassment | spam | inappropriate | hate_speech | other\nsessionId is optional"
          }
        },
        {
          "name": "Get My Reports",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/reports/mine?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["reports", "mine"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            }
          }
        }
      ]
    },
    {
      "name": "Admin",
      "item": [
        {
          "name": "Get Stats",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/stats",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "stats"]
            },
            "description": "Admin only. Platform-wide stats: totalUsers, bannedUsers, totalSessions, sessionsToday, activeReports."
          }
        },
        {
          "name": "List Users",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/users?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "search", "value": "", "disabled": true, "description": "Search by email, displayName or username" },
                { "key": "isBanned", "value": "false", "disabled": true, "description": "true | false" },
                { "key": "role", "value": "student", "disabled": true, "description": "student | admin" }
              ]
            },
            "description": "Admin only. Paginated user list with profile and pending report count."
          }
        },
        {
          "name": "Get User Detail",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}"]
            },
            "description": "Admin only. Full user detail including profile, pending report count, total report count."
          }
        },
        {
          "name": "Ban / Unban User",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"banned\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}/ban",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}", "ban"]
            },
            "description": "Admin only.\nbanned: true → bans user + revokes all refresh tokens\nbanned: false → unbans user\nCannot ban another admin account."
          }
        },
        {
          "name": "Set User Role",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/users/{{userId}}/role",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "users", "{{userId}}", "role"]
            },
            "description": "Admin only. role: student | admin"
          }
        },
        {
          "name": "Get All Reports",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/reports?page=1&limit=20&status=pending",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "reports"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "status", "value": "pending", "description": "pending | reviewed | actioned | dismissed" }
              ]
            },
            "description": "Admin only. Filter by status (optional)."
          }
        },
        {
          "name": "Update Report (Review / Ban)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"actioned\",\n  \"adminNote\": \"User warned and banned\",\n  \"banReportedUser\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/reports/{{reportId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "reports", "{{reportId}}"]
            },
            "description": "Admin only.\nstatus: pending | reviewed | actioned | dismissed\nbanReportedUser: true → sets user.is_banned=true and revokes all refresh tokens"
          }
        }
      ]
    },
    {
      "name": "Notifications",
      "item": [
        {
          "name": "Register Device Token",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fcmToken\": \"<fcm_device_token_here>\",\n  \"deviceId\": \"device-001\",\n  \"platform\": \"android\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/device",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "device"]
            },
            "description": "Call on every app launch — upserts the FCM token for this device.\nplatform: ios | android"
          }
        },
        {
          "name": "Unregister Device Token",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceId\": \"device-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/notifications/device",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "device"]
            },
            "description": "Call on logout — removes the FCM token for this device only so push stops."
          }
        },
        {
          "name": "Get My Notifications",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["notifications"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20", "description": "max 50" }
              ]
            },
            "description": "Returns paginated notifications for the current user, newest first.\nResponse: { notifications[], total, page, limit }"
          }
        },
        {
          "name": "Mark All as Read",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications/read-all",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "read-all"]
            }
          }
        },
        {
          "name": "Mark Single Notification as Read",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/notifications/{{notificationId}}/read",
              "host": ["{{baseUrl}}"],
              "path": ["notifications", "{{notificationId}}", "read"]
            }
          }
        }
      ]
    },
    {
      "name": "Matchmaking (Socket.io)",
      "description": "Socket.io events — connect to {{socketUrl}} with auth token.\n\nConnect:\n  const socket = io('http://localhost:5503', { auth: { token: 'Bearer <accessToken>' } })\n\nCLIENT → SERVER events:\n  find_partner   { level?: 'beginner'|'intermediate'|'advanced', topic?: string }\n  cancel_search  (no payload)\n\nSERVER → CLIENT events:\n  searching      { estimated_wait_seconds: number }\n  match_found    { roomId, partner: { userId, displayName, avatarUrl, level }, iceServers }\n  peer_left      { reason: 'disconnect' }\n  error          { code, message }",
      "item": [
        {
          "name": "Socket.io Connection Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/socket.io/?EIO=4&transport=polling",
              "host": ["{{baseUrl}}"],
              "path": ["socket.io", ""],
              "query": [
                { "key": "EIO", "value": "4" },
                { "key": "transport", "value": "polling" }
              ]
            },
            "description": "Use this to verify the Socket.io server is running.\n\nTo actually test matchmaking, use a Socket.io client in code:\n\nconst { io } = require('socket.io-client')\nconst socket = io('http://localhost:5503', {\n  auth: { token: 'Bearer <accessToken>' }\n})\nsocket.on('connect', () => console.log('connected'))\nsocket.emit('find_partner', { level: 'beginner' })\nsocket.on('match_found', (data) => console.log(data))"
          }
        }
      ]
    },
    {
      "name": "Courses (LMS)",
      "item": [
        {
          "name": "List Courses",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/courses?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["courses"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "level", "value": "beginner", "disabled": true, "description": "beginner | intermediate | advanced" },
                { "key": "isPremium", "value": "false", "disabled": true, "description": "true | false" }
              ]
            },
            "description": "Public. Returns paginated published courses. If authenticated, each course includes an 'enrolled' flag."
          }
        },
        {
          "name": "Get Course",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.id) {",
                  "  pm.environment.set('courseId', res.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}"]
            },
            "description": "Public. Returns course details with lessons array. If authenticated, includes enrollment status and progress."
          }
        },
        {
          "name": "Get My Courses",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/courses/my?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "my"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            },
            "description": "Auth required. Returns enrolled courses with progress for the current user."
          }
        },
        {
          "name": "Enroll in Course",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}/enroll",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}", "enroll"]
            },
            "description": "Auth required. Enrolls the current user in the course. Creates a UserCourseProgress record."
          }
        },
        {
          "name": "Get Lesson",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.id) {",
                  "  pm.environment.set('lessonId', res.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}/lessons/{{lessonId}}",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}", "lessons", "{{lessonId}}"]
            },
            "description": "Auth required. Premium courses require enrollment. Returns lesson with 'completed' flag."
          }
        },
        {
          "name": "Complete Lesson",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}/lessons/{{lessonId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}", "lessons", "{{lessonId}}", "complete"]
            },
            "description": "Auth required. Marks a video/pdf/text lesson as complete and updates course progress. Not valid for quiz lessons — those are completed via /quiz/submit."
          }
        },
        {
          "name": "Get Quiz",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}/lessons/{{lessonId}}/quiz",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}", "lessons", "{{lessonId}}", "quiz"]
            },
            "description": "Auth required. Returns quiz with questions and options (isCorrect hidden). Includes bestAttempt if the user has previously submitted."
          }
        },
        {
          "name": "Submit Quiz",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"answers\": [\n    {\n      \"questionId\": \"<question-uuid>\",\n      \"selectedOptionIds\": [\"<option-uuid>\"]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/courses/{{courseId}}/lessons/{{lessonId}}/quiz/submit",
              "host": ["{{baseUrl}}"],
              "path": ["courses", "{{courseId}}", "lessons", "{{lessonId}}", "quiz", "submit"]
            },
            "description": "Auth required. Must answer every question. Returns { score, passed, answers }.\nIf passed (score >= passingScore), marks the lesson as complete and updates course progress."
          }
        },
        {
          "name": "[Admin] Create Course",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.id) {",
                  "  pm.environment.set('courseId', res.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"English for Beginners\",\n  \"description\": \"A complete beginner course to get you started.\",\n  \"level\": \"beginner\",\n  \"isPremium\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses"]
            },
            "description": "Admin only. Creates a course (isPublished=false by default).\nlevel: beginner | intermediate | advanced"
          }
        },
        {
          "name": "[Admin] Update Course",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Updated Title\",\n  \"isPublished\": true,\n  \"isPremium\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}"]
            },
            "description": "Admin only. Partial update — pass only fields you want to change.\nSet isPublished: true to make the course visible to users."
          }
        },
        {
          "name": "[Admin] Upload Course Thumbnail",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "thumbnail",
                  "type": "file",
                  "src": "",
                  "description": "jpeg/png/webp image — max 20MB"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/thumbnail",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "thumbnail"]
            },
            "description": "Admin only. Uploads a thumbnail image. Replaces any existing thumbnail."
          }
        },
        {
          "name": "[Admin] Create Lesson",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.id) {",
                  "  pm.environment.set('lessonId', res.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Introduction\",\n  \"type\": \"video\",\n  \"videoUrl\": \"https://example.com/intro.mp4\",\n  \"order\": 0,\n  \"durationMinutes\": 10\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons"]
            },
            "description": "Admin only. Creates a lesson and increments course.totalLessons.\ntype: video | pdf | text | quiz\nFor quiz lessons, create the quiz separately via POST /admin/courses/:id/lessons/:lessonId/quiz"
          }
        },
        {
          "name": "[Admin] Update Lesson",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Updated Lesson Title\",\n  \"order\": 1,\n  \"durationMinutes\": 15\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons/{{lessonId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons", "{{lessonId}}"]
            },
            "description": "Admin only. Partial update for lesson metadata."
          }
        },
        {
          "name": "[Admin] Upload Lesson PDF",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "pdf",
                  "type": "file",
                  "src": "",
                  "description": "PDF file — max 20MB"
                }
              ]
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons/{{lessonId}}/pdf",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons", "{{lessonId}}", "pdf"]
            },
            "description": "Admin only. Uploads a PDF for the lesson. Also sets lesson.type = 'pdf'."
          }
        },
        {
          "name": "[Admin] Delete Lesson",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons/{{lessonId}}",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons", "{{lessonId}}"]
            },
            "description": "Admin only. Deletes the lesson, removes any PDF from storage, and decrements course.totalLessons."
          }
        },
        {
          "name": "[Admin] Create Quiz",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Unit 1 Quiz\",\n  \"passingScore\": 70,\n  \"questions\": [\n    {\n      \"question\": \"What is the plural of 'child'?\",\n      \"type\": \"single\",\n      \"order\": 0,\n      \"options\": [\n        { \"text\": \"childs\", \"isCorrect\": false },\n        { \"text\": \"children\", \"isCorrect\": true },\n        { \"text\": \"childes\", \"isCorrect\": false }\n      ]\n    },\n    {\n      \"question\": \"Which of these are vowels?\",\n      \"type\": \"multiple\",\n      \"order\": 1,\n      \"options\": [\n        { \"text\": \"a\", \"isCorrect\": true },\n        { \"text\": \"b\", \"isCorrect\": false },\n        { \"text\": \"e\", \"isCorrect\": true },\n        { \"text\": \"c\", \"isCorrect\": false }\n      ]\n    }\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons/{{lessonId}}/quiz",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons", "{{lessonId}}", "quiz"]
            },
            "description": "Admin only. Creates a quiz for a lesson. Also sets lesson.type = 'quiz'.\ntype: single (one correct answer) | multiple (multiple correct answers)\npassingScore: 1-100, defaults to 70"
          }
        },
        {
          "name": "[Admin] Update Quiz",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Updated Quiz Title\",\n  \"passingScore\": 80\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/admin/courses/{{courseId}}/lessons/{{lessonId}}/quiz",
              "host": ["{{baseUrl}}"],
              "path": ["admin", "courses", "{{courseId}}", "lessons", "{{lessonId}}", "quiz"]
            },
            "description": "Admin only. Update quiz title and/or passingScore only."
          }
        }
      ]
    },
    {
      "name": "Payments",
      "item": [
        {
          "name": "Get Price Quote",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.priceToken) {",
                  "  pm.environment.set('priceToken', res.data.priceToken);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/payments/courses/{{courseId}}/quote",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "courses", "{{courseId}}", "quote"]
            },
            "description": "Auth required. Step 1 of checkout.\nGenerates a one-time price quote token (10min TTL) tied to the authenticated user.\nReturns: { priceToken, price, currency, expiresIn }\nClient must pass priceToken to the checkout endpoint — never send raw price."
          }
        },
        {
          "name": "Create Checkout Session",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "const res = pm.response.json();",
                  "if (res.data && res.data.checkoutUrl) {",
                  "  pm.environment.set('checkoutUrl', res.data.checkoutUrl);",
                  "  pm.environment.set('paymentSessionId', res.data.sessionId);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" },
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Idempotency-Key", "value": "{{$guid}}", "description": "Client-generated UUID. Reuse on retry, generate new for new attempt." }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"priceToken\": \"{{priceToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/courses/{{courseId}}/checkout",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "courses", "{{courseId}}", "checkout"]
            },
            "description": "Auth required. Step 2 of checkout.\nRequires priceToken from the /quote endpoint (one-time use, 10min TTL).\nRequires Idempotency-Key header (UUID) — same key on retry returns cached result.\nReturns: { checkoutUrl, sessionId }\nRedirect user to checkoutUrl to complete payment on Stripe."
          }
        },
        {
          "name": "Stripe Webhook (reference only)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "stripe-signature", "value": "t=...,v1=...", "description": "Set by Stripe automatically" },
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{ \"type\": \"checkout.session.completed\", \"data\": { \"object\": {} } }"
            },
            "url": {
              "raw": "{{baseUrl}}/payments/webhook",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "webhook"]
            },
            "description": "Called by Stripe — NOT by client.\nVerifies stripe-signature HMAC.\nOn checkout.session.completed:\n  1. Validates amountPaid matches DB record\n  2. DB transaction: marks payment paid + enrolls user\n  3. Sends push notification to user\nConfigure this URL in your Stripe Dashboard → Webhooks."
          }
        },
        {
          "name": "Get Payment History",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{accessToken}}" }
            ],
            "url": {
              "raw": "{{baseUrl}}/payments/history?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["payments", "history"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            },
            "description": "Auth required. Returns paginated payment history for the current user."
          }
        }
      ]
    },
    {
      "name": "WebRTC Signaling (Socket.io)",
      "description": "WebRTC signaling events — uses the same Socket.io connection as Matchmaking.\n\nFLOW:\n  1. Both users receive match_found → get roomId\n  2. Both emit join_room { roomId }\n  3. Server emits peer_joined to both:\n       caller   → create RTCPeerConnection, create offer, emit webrtc_offer\n       receiver → create RTCPeerConnection, wait for offer\n  4. Caller emits webrtc_offer { roomId, sdp }\n  5. Receiver emits webrtc_answer { roomId, sdp }\n  6. Both sides emit webrtc_ice { roomId, candidate } as candidates arrive\n  7. Either side emits end_call { roomId } to terminate\n\nCLIENT → SERVER events:\n  join_room     { roomId }\n  webrtc_offer  { roomId, sdp: RTCSessionDescriptionInit }\n  webrtc_answer { roomId, sdp: RTCSessionDescriptionInit }\n  webrtc_ice    { roomId, candidate: RTCIceCandidateInit }\n  end_call      { roomId }\n\nSERVER → CLIENT events:\n  peer_joined   { role: 'caller'|'receiver', roomId }\n  webrtc_offer  { roomId, sdp }\n  webrtc_answer { roomId, sdp }\n  webrtc_ice    { roomId, candidate }\n  peer_left     { reason: 'ended'|'disconnect' }\n  error         { code, message }",
      "item": [
        {
          "name": "Signaling Flow Reference",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/socket.io/?EIO=4&transport=polling",
              "host": ["{{baseUrl}}"],
              "path": ["socket.io", ""],
              "query": [
                { "key": "EIO", "value": "4" },
                { "key": "transport", "value": "polling" }
              ]
            },
            "description": "WebRTC signaling runs over the same Socket.io connection.\nNo separate HTTP endpoint — all signaling is via Socket.io events.\n\nExample (caller side after receiving peer_joined with role='caller'):\n\nconst pc = new RTCPeerConnection({ iceServers })\n\npc.onicecandidate = ({ candidate }) => {\n  if (candidate) socket.emit('webrtc_ice', { roomId, candidate })\n}\n\nsocket.on('webrtc_ice', ({ candidate }) => pc.addIceCandidate(candidate))\nsocket.on('webrtc_answer', ({ sdp }) => pc.setRemoteDescription(sdp))\n\nconst offer = await pc.createOffer()\nawait pc.setLocalDescription(offer)\nsocket.emit('webrtc_offer', { roomId, sdp: pc.localDescription })\n\n────────────────────────────────────────────────────────\n\nExample (receiver side after receiving peer_joined with role='receiver'):\n\nconst pc = new RTCPeerConnection({ iceServers })\n\npc.onicecandidate = ({ candidate }) => {\n  if (candidate) socket.emit('webrtc_ice', { roomId, candidate })\n}\n\nsocket.on('webrtc_ice', ({ candidate }) => pc.addIceCandidate(candidate))\nsocket.on('webrtc_offer', async ({ sdp }) => {\n  await pc.setRemoteDescription(sdp)\n  const answer = await pc.createAnswer()\n  await pc.setLocalDescription(answer)\n  socket.emit('webrtc_answer', { roomId, sdp: pc.localDescription })\n})"
          }
        }
      ]
    }
  ]
}
